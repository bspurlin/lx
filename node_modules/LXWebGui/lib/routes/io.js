// Elements in the output array are of the form: 
// {type: <string>,action: <function (socket) >}; 
// type is the message type (provided by client) to which
// the function will respond
var socketActions = function(app,io,routes) { 
	return [
		{
			type: "scanreq",
			action: function (socket) { 
					return function (message_from_browser) { 
					message_from_browser.jfiles = app.locals.jfiles; 
					routes.scan.io(message_from_browser,function (err,jfile,path) { 
						if(err) {
							io.to(socket.id).emit("error",{msg: err.toString()}); 
						} else { 
							app.locals.jfiles[jfile] = path; 
							io.to(socket.id).emit("scandone",{msg: jfile}); 
						}
					}); 
				}; 
			} 		
		}
	]; 
};  


module.exports = function(app,io,routes) { 
	var actions = socketActions(app,io,routes); 
	io.on("connection", function (socket) { 
			actions.forEach(function (input) { 
				socket.on(input.type,input.action(socket)); 
			});
	});
};